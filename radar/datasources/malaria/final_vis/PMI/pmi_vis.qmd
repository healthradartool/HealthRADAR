---
execute:
  warning: false
  error: false
---


```{r, output = FALSE}
# Load packages
source("../theme_health_radar.R")
library(readxl)
library(tidyverse)
library(reshape2)
```
Annual malaria incidence in different countries over time can be easily visualised using line plots. The points plotted at each data point help to communicate that these are annual data, rather than continuous. 

```{r}
incidence_pmi <- read_excel("malaria_incidence_PMI.xlsx")

# Reshape the data from wide to long format
incidence_long <- incidence_pmi |>
  pivot_longer(cols = -Country, names_to = "Year", values_to = "Incidence") |>
  mutate(Year = as.numeric(Year))  # Convert Year to numeric for plotting

# Convert 'Incidence' to numeric
incidence_long$Incidence <- as.numeric(as.character(incidence_long$Incidence))

# Create a ggplot object with incidence_long data
ggplot(incidence_long, aes(x = Year, y = Incidence, color = Country, group = Country)) +
  # Add lines connecting data points for each country
  geom_line() +
  # Add points at each data point for each country
  geom_point() +
  # Customize the x-axis to show every year in the data range
  scale_x_continuous(breaks = min(incidence_long$Year):max(incidence_long$Year)) + 
  # Customize the y-axis to show breaks from 0 to 400 in increments of 50
  scale_y_continuous(breaks = seq(0, 400, 50)) + 
  # Apply a custom theme 
  theme_health_radar() +
  # Apply a custom color scale 
  scale_colour_manual_health_radar() +  
  # Rotate x-axis text labels 45 degrees and adjust horizontal justification
  theme(axis.text.x = element_text(angle = 45, hjust = 0.5)) +
  # Add labels and title to the plot
  labs(
    title = "Annual malaria incidence (2009-2022)",
    x = "Year",
    y = "Incidence (per 1000 people)",
    colour = "Country",
    # Add a caption with wrapped text for better readability
    caption = str_wrap("The annual malaria incidence (per 1000 people) in Angola, Mozambique, Zambia, and Zimbabwe from 2008 to 2022. Mozambique consistently shows the highest incidence, with a slight decline over the years, stabilizing at around 320 cases per 1000 people by 2022. Zambiaâ€™s incidence initially increases until 2014, after which it starts to decline. In Angola, malaria incidence shows an initial decline from 2009 to 2012, followed by a steady rise peaking in 2021, indicating a worsening malaria burden over time. Zimbabwe shows the lowest malaria incidence, marked by significant variability, with the lowest values seen after 2020. These trends highlight differing malaria control progress and challenges across the four countries. Source: World Malaria Report", width = 85)
  )
```
A paired bar plot is used to compare ITN usage in children under 5 in various countries, before and after PMI implementation. 

```{r}
coverage_itn <- read_excel("nets_under5_PMI.xlsx")

# Reshape the data for ggplot
coverage_itn_melted <- melt(coverage_itn, id.vars = "Country", variable.name = "Type", value.name = "Percentage")

# Create a ggplot object with coverage_itn_melted data
ggplot(coverage_itn_melted, aes(x = Country, y = Percentage, fill = Type)) +
  # Add bar plots with identity stat and dodge position for side-by-side bars
  geom_bar(stat = "identity", position = position_dodge()) +
  # Apply a custom theme 
  theme_health_radar() +
  # Apply a custom fill scale 
  scale_fill_manual_health_radar() +
  # Add labels and title to the plot
  labs(
    title = "ITN usage among children under 5",
    x = "",  # No label for the x-axis
    y = "Percentage (%)",
    # Add a caption with wrapped text for better readability
    caption = str_wrap("The baseline and endline percentage Insecticide Treated Net (ITN) usage among children under 5 living in Angola, Mozambique, Zambia, and Zimbabwe. The baseline percentage indicates the ITN usage by children under 5 prior to the implementation of the President's Malaria Initiative (PMI), while the endline percentage indicates ITN usage in children under 5 after the implementation of the PMI. Zambia shows the highest endline percentage of ITN coverage, with a significant increase from the baseline. Mozambique shows the most pronounced increase from the baseline. Angola exhibits a relatively small increase in the percentage use of ITNs by children under 5. Source: World Malaria Report", width = 90),
    fill = ""  # No label for the fill legend
  )
```
The percentage of women receiving Intermittent Preventative Treatment in pregnancy (IPTp) in various countries is represented using a simple bar plot. 

```{r}
# Define a single colour for the plot
single_color <- "#1b9e77"

coverage_iptp <- read_excel("IPTP_coverage_PMI.xlsx")

# Create a ggplot object with coverage_iptp data
ggplot(coverage_iptp, aes(x = Country, y = Percentage)) +
  # Add bar plots with identity stat and a single fill color
  geom_bar(stat = "identity", fill = single_color) +
  # Apply a custom theme 
  theme_health_radar() +
  # Add labels and title to the plot
  labs(
    title = "Percentage of women receiving IPTp",
    y = "Percentage (%)",
    x = "",  # No label for the x-axis
    # Add a caption with wrapped text for better readability
    caption = str_wrap("The percentage of women receiving Intermittent Preventative Treatment in pregnancy (IPTp) in Angola, Mozambique, Zambia and Zimbabwe. Zambia exhibits the highest coverage, while the other countries have less than 30% of women receiving IPTp. Source: World Malaria Report", width = 100)
  )
```

