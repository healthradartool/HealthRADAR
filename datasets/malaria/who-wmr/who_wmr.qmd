---
title: "World Malaria Report"
subtitle: "The report provides a comprehensive and up-to-date assessment of trends in malaria control and elimination across the globe."
image: "images/wmr-covers-2023.jpg"
execute:
  message: false
  warning: false
  
page-layout: full
title-block-banner: "#EDF3F9"
title-block-banner-color: "#212529"
categories:
  - malaria
  - epidemiology
  - interventions
  - country-level
  - annual
---

## About the data

The WHO World Malaria report, released on an annual basis, provides a comprehensive and up-to-date assessment of trends in malaria control and elimination across the globe. The annexes to the report provide useful information on the data sources and methods used to compile the World Malaria Report, a set of regional malaria profiles and tables of historical time series of case data, commodity distribution, funding amounts and policy adoption.

These datasets provide information on long term trends in malaria control and enable comparison between countries. The data provided are on an annual time scale at the national level, and would not be suitable for subnational analysis or to explore seasonal trends in malaria.

## Accessing the data

The reports can be accessed on the [WHO website](https://www.who.int/teams/global-malaria-programme/reports). Each report has a web page which includes useful contextual information as well as additional resources. The “Annexes in Excel format” will download as a zip file which should be extracted. The annexes can be viewed in the original report in PDF format, though for modelling it is usually preferable to have an excel spreadsheet.

The most recent report may not contain all years of estimates. Should earlier years be required, one can access the annexes from earlier reports and merge these.

## What does the data look like?

### Description

The list of annexes may vary annually. The information included typically looks like this. Data are available for each country and annually. Some datasheets contain a few years of data, while others report data for the most recent year. To make a longer time series of data, you can access older world malaria reports and annexes from the WHO. Be careful to check the data definitions and information on methodology to be sure that data sets can be concatenated.

The annexes can be found in the report itself as in the following examples: ![](images/annex4F.png "WHO World Malaria Report 2023 Annex 4F")

![](images/annex4H.png "WHO World Malaria Report 2023 Annex 4H")

The annexes can also be downloaded as Excel documents from the report page.

|         |                                                                                                              |
|----------------------|-------------------------------------------------|
| Annex 1 | Data sources and methods                                                                                     |
| Annex 2 | Number of ITNs distributed through campaigns in malaria endemic countries                                    |
| Annex 3 | WHO Regional profiles                                                                                        |
| Annex 4 | Data tables and methods                                                                                      |
|         | A. Policy adoption                                                                                           |
|         | B. Antimalarial drug policy                                                                                  |
|         | C. Funding for malaria control                                                                               |
|         | D. Commodities distribution and coverage                                                                     |
|         | E. Household survey results                                                                                  |
|         | F. Population denominator for case incidence and mortality rate, and estimated malaria cases and deaths      |
|         | G. Population denominator for case incidence and mortality rate, and reported malaria cases by place of care |
|         | H. Reported malaria cases by method of confirmation                                                          |
|         | I. Reported malaria cases by species                                                                         |
|         | J. Reported malaria deaths                                                                                   |
|         | K. Methods for Tables A-D-G-H-I-J                                                                            |

: Example of the annex layout. This example is from the 2023 world malaria report. Note that the annexes are paired with the report and should be interpreted as such.

::: {.callout-note collapse=true}

## How to use this data?

Here is an example illustrating how to download the data, unzip it and read in a sheet

```{r}

downloadIfNotExists <- function(url, filename) {
  if (!file.exists(filename)) {
    download.file(url, filename)
  }
  if (!dir.exists(gsub(".zip", "", filename))) {
    zip::unzip(zipfile = filename, exdir = gsub(".zip", "", filename))
  }
  fnames <- list.files(gsub(".zip", "", filename), recursive = T, full.names = T)
  gsub(paste0("^",gsub(".zip", "", filename),"/"), "", fnames)
}

# Download and unzip the annexes:
url <- "https://cdn.who.int/media/docs/default-source/malaria/world-malaria-reports/wmr2017-excel-annexes.zip"
pathbase <- tempdir()
fpaths <- downloadIfNotExists(url, filename=file.path(pathbase,"wmr2017-excel-annexes.zip"))

# Read in the sheet:
filename <- file.path(pathbase,"wmr2017-excel-annexes/wmr2017-annex-table-a.xls")
wmr2017a <- readxl::read_excel(filename, range = "A2:Q102")
head(wmr2017a)

```


::: callout-warning
Should the above link not work, find it at <https://www.who.int/teams/global-malaria-programme/reports>
:::

<br>

:::


::: {.callout-note collapse=true}

## How to plot this data?

Splitting the WHO REGION column can be done with this:

```{r}
split_who_region <- function(df,
                             col_region_area=1,
                             region_name="WHO Region",
                             area_name="Country/area",
                             col_na_when_region=NA,
                             fill_down_first=TRUE) {
  if (length(intersect(c(region_name, area_name), colnames(df)))!=0) {
    stop("region_name and area_name must not be in the dataframe")
  }
  df[,region_name] <- NA
  df[,area_name] <- NA
  for (i in seq(1, nrow(df))) {
    if (fill_down_first) {
      if (is.na(df[i, col_region_area])) {
        df[i, col_region_area] <- df[i-1, col_region_area]
      }
    }
    if(is.na(col_na_when_region)) {
      is_new_region <- !grepl("[a-z]", df[i, col_region_area, drop=TRUE])
    } else {
      is_new_region <- is.na(df[i, col_na_when_region, drop=TRUE])
    }
    if (is_new_region) {
      # print(paste0("Updating ",col_region_area," because is.na(df[",i,",",col_na_when_region,"])"))
      current_region <- df[i, col_region_area, drop=TRUE]
    } else {
      df[i,area_name] <- df[i, col_region_area, drop=TRUE]
    }
    df[i,region_name] <- current_region
  }
  rows_na_area <- is.na(df[,area_name, drop=TRUE])
  cnames <- setdiff(colnames(df), colnames(df[,col_region_area]))
  cnames_ordered <- c(region_name, area_name, head(cnames,-2))
  df <- df[!rows_na_area, cnames_ordered]
  df
}

split_who_region(wmr2017a)
```

```{r}

library(tidyverse)

# Create the data frame
data <- data.frame(
  Country = c("Benin", "Burkina Faso", "Burkina Faso", "Cameroon", "Côte d'Ivoire", "Gambia", "Ghana", "Guinea", "Guinea", "Kenya", "Kenya", "Liberia", "Madagascar", "Mali", "Mali", "Mauritania", "Mozambique", "Niger", "Nigeria", "Nigeria", "Rwanda", "Senegal", "Senegal", "Senegal", "Sierra Leone", "Uganda", "Zambia"),
  Survey = c("2017-18 DHS", "2017-18 MIS", "2021 DHS", "2018 DHS", "2021 DHS", "2019-20 DHS", "2019 MIS", "2018 DHS", "2021 MIS", "2020 MIS", "2022 DHS", "2019-20 DHS", "2021 DHS", "2018 DHS", "2021 MIS", "2019-21 DHS", "2018 MIS", "2021 MIS", "2018 DHS", "2021 MIS", "2019-20 DHS", "2018 DHS", "2019 DHS", "2020-21 MIS", "2019 DHS", "2018-19 MIS", "2018 DHS"),
  Percentage = c(91.5, 75.3, 82.8, 73.4, 72.1, 77.3, 73.7, 43.9, 63.3, 49.0, 54.2, 54.7, 69.1, 89.8, 90.9, 32.2, 82.2, 96.0, 60.6, 56.0, 66.4, 76.6, 81.0, 75.3, 67.9, 83.0, 78.3)
)

# Sort the data by percentage
data <- data %>%
  arrange(Percentage)

# Create the lollipop plot
ggplot(data, aes(x = reorder(Country, Percentage), y = Percentage, color = Survey)) +
  geom_segment(aes(x = Country, xend = Country, y = 0, yend = Percentage), color = "grey") +
  geom_point(size = 4) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Percentage of Households with at least one ITN",
       subtitle = "Data for selected countries",
       caption = "Source WMR 2023 Annex 4Ea",
       x = "Country",
       y = "Percentage",
       color = "Source") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 20, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 15),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    legend.title = element_text(size = 15),
    legend.text = element_text(size = 12)
  )


```


```{r}

library(tidyverse)
library(ggrepel)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)

# Create the data frame
data <- data.frame(
  Country = c("Benin", "Burkina Faso", "Burkina Faso", "Cameroon", "Côte d'Ivoire", "Gambia", "Ghana", "Guinea", "Guinea", "Kenya", "Kenya", "Liberia", "Madagascar", "Mali", "Mali", "Mauritania", "Mozambique", "Niger", "Nigeria", "Nigeria", "Rwanda", "Senegal", "Senegal", "Senegal", "Sierra Leone", "Uganda", "Zambia"),
  Survey = c("2017-18 DHS", "2017-18 MIS", "2021 DHS", "2018 DHS", "2021 DHS", "2019-20 DHS", "2019 MIS", "2018 DHS", "2021 MIS", "2020 MIS", "2022 DHS", "2019-20 DHS", "2021 DHS", "2018 DHS", "2021 MIS", "2019-21 DHS", "2018 MIS", "2021 MIS", "2018 DHS", "2021 MIS", "2019-20 DHS", "2018 DHS", "2019 DHS", "2020-21 MIS", "2019 DHS", "2018-19 MIS", "2018 DHS"),
  Percentage = c(91.5, 75.3, 82.8, 73.4, 72.1, 77.3, 73.7, 43.9, 63.3, 49.0, 54.2, 54.7, 69.1, 89.8, 90.9, 32.2, 82.2, 96.0, 60.6, 56.0, 66.4, 76.6, 81.0, 75.3, 67.9, 83.0, 78.3)
)

# Remove duplicate entries, keeping only the first occurrence for each country
data_unique <- data %>% distinct(Country, .keep_all = TRUE)

# Load the map data for Africa
africa <- ne_countries(continent = "Africa", returnclass = "sf")

# Define West African countries
west_african_countries <- c("Benin", "Burkina Faso", "Cabo Verde", "Côte d'Ivoire", 
                            "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Liberia", 
                            "Mali", "Mauritania", "Niger", "Nigeria", "Senegal", 
                            "Sierra Leone", "Togo")

# Subset by West Africa
west_africa <- africa %>% 
  filter(name %in% west_african_countries)

# Merge the map data with your data
west_africa_data <- west_africa %>%
  left_join(data_unique, by = c("name" = "Country"))

# Create the choropleth map
ggplot(data = west_africa_data) +
  geom_sf(aes(fill = Percentage)) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50", name = "Percentage") +
  theme_minimal() +
  labs(title = "Percentage of Households with at least one ITN",
       subtitle = "Data for selected countries. Countries in grey have no data available.",
       caption = "Source: WMR 2023 Annex 4Ea") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    legend.position = "right"
  ) +
  geom_sf_text(aes(label = name, fill = Percentage, color = ifelse(Percentage > 50, "black", "white")), size = 3) +
  scale_color_identity()


```


```{r}
options(scipen = 9)

# Read in the csv file
data <- read_csv("tutorial_data/filtered_data.csv")

# Divide the cases and deaths by 1000 for better readability
data$Cases_Point <- data$Cases_Point / 1000
data$Cases_Lower <- data$Cases_Lower / 1000
data$Cases_Upper <- data$Cases_Upper / 1000
data$Deaths_Point <- data$Deaths_Point / 1000
data$Deaths_Lower <- data$Deaths_Lower / 1000
data$Deaths_Upper <- data$Deaths_Upper / 1000

unique(data$Country)
```

```{r}
# Create the plot for Deaths with low and high bands
ggplot(data, aes(x = Year, y = Cases_Point, group = Country, color = Country)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = Cases_Lower, ymax = Cases_Upper, fill = Country), alpha = 0.2) +
  labs(
    title = "Reported Malaria Cases Over Time",
    subtitle = "With confidence bands",
    x = "Year",
    y = "Number of Cases (thousands)",
    color = "Country",
    fill = "Country",
    caption = "Source: WMR 2023 Annex 4F"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 14, face = "bold"),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    plot.margin = margin(t = 20, r = 20, b = 40, l = 20)
  ) +
  guides(color = guide_legend(title.position = "top", title.hjust = 0.5),
         fill = guide_legend(title.position = "top", title.hjust = 0.5))
```

```{r}

# Define colours, with specified countries highlighted and others grayed out
country_colors <- c(
  "Mozambique" = "#e75480"    # Highlight Mozambique
)

# Assign gray color to all other countries
all_countries <- unique(data$Country)
other_countries <- setdiff(all_countries, names(country_colors))
for (country in other_countries) {
  country_colors[country] <- "gray"
}

# Subset data for Mozambique
mozambique_data <- subset(data, Country == "Mozambique")

# Create the plot for Deaths with low and high bands
p <- ggplot(data, aes(x = Year, y = Deaths_Point, group = Country, color = Country)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = Deaths_Lower, ymax = Deaths_Upper, fill = Country), alpha = 0.2) +
  geom_line(data = mozambique_data, aes(x = Year, y = Deaths_Point), color = "#e75480", size = 1.5) +  # Highlight Mozambique line
  labs(
    title = "Reported Malaria Deaths Over Time",
    subtitle = "With confidence bands, highlighting Mozambique",
    x = "Year",
    y = "Number of Deaths (thousands)",
    color = "Country",
    fill = "Country",
    caption = "Source: WMR 2023 Annex 4F"
  ) +
  scale_color_manual(values = country_colors, guide = 'none') +
  scale_fill_manual(values = country_colors, guide = 'none') +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 14, face = "bold"),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    plot.margin = margin(t = 20, r = 20, b = 40, l = 20)
  )

# Find the middle year for Mozambique
middle_year <- median(mozambique_data$Year)
middle_index <- which.min(abs(mozambique_data$Year - middle_year))

# Get the middle data point for Mozambique
middle_year <- mozambique_data$Year[middle_index]
middle_deaths_upper <- mozambique_data$Deaths_Upper[middle_index]

# Add annotation for Mozambique at the middle point
p + annotate("text", x = middle_year + 0.5, y = middle_deaths_upper + 8, label = "Mozambique", hjust = 0.5, size = 5, color = "#e75480", fontface = "bold") +
  geom_segment(aes(x = middle_year, y = middle_deaths_upper, xend = middle_year + 0.5, yend = middle_deaths_upper + 5), color = "#e75480", arrow = arrow(length = unit(0.2, "cm")))

```

```{r}

# Read in the costing data
costing_df <- read_csv("tutorial_data/costing_df.csv")

# Reshape data for plotting
plot_df <- costing_df %>%
  pivot_longer(cols = starts_with("Country_"), names_to = "Donor", values_to = "Amount") %>%
  mutate(Donor = gsub("Country_", "", Donor)) # Remove "Country_" from the Donor names

# Set the order of the donors so that "Govt_NMP" is last
plot_df$Donor <- factor(plot_df$Donor, levels = c(
  "GlobalFund", "WorldBank", "PMI_USAID", "OtherBilaterals", 
  "WHO", "UNICEF","Govt_NMP", "OtherContributions"
))

# Define a manual color palette
manual_colors <- c(
  "GlobalFund" = "#1b9e77", 
  "PMI_USAID" = "#d95f02", 
  "WorldBank" = "#7570b3", 
  "OtherBilaterals" = "#e7298a", 
  "WHO" = "#66a61e", 
  "UNICEF" = "#e6ab02", 
  "OtherContributions" = "#a6761d", 
  "Govt_NMP" = "#666666"
)

# Create the plot
ggplot(plot_df, aes(x = Year, y = Amount / 1000, fill = Donor)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Country, scales = "free_y") +
  scale_fill_manual(values = manual_colors) + # Use the manual color palette
  labs(
    title = "Stacked Bar Plot of Country Contributions Over the Years",
    subtitle = "For Selected Countries",
    x = "Year",
    y = "Contributions (in thousands)",
    fill = "Donor",
    caption = "Source: WMR 2023 4C"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

:::

## Key points to consider

## Pitfalls of Annual Data:

Using annual data in the model can lead to several pitfalls:

```{=tex}
\begin{itemize}

\item Seasonal variations: Annual data may not capture the seasonal patterns of malaria transmission, which can be influenced by factors such as rainfall, temperature, and vector abundance. This can lead to an over- or underestimation of the disease burden and the impact of interventions.

\item Temporal aggregation: Aggregating data annually may mask important short-term dynamics, such as outbreaks or the immediate impact of interventions. This can limit the model's ability to accurately predict the timing and magnitude of changes in disease transmission.

\end{itemize}
```

## Reporting - Incidence vs. Prevalence Data:

It is important to distinguish between incidence and prevalence data when building and interpreting the model:

```{=tex}
\begin{itemize}

\item Incidence data: Incidence refers to the number of new cases of malaria occurring in a population over a specified period. It provides information on the rate at which new infections occur and is more sensitive to changes in transmission dynamics.

\item Prevalence data: Prevalence refers to the proportion of the population that has malaria at a given point in time. It provides a snapshot of the disease burden but does not capture the rate of new infections.

\end{itemize}
```

When using data to parameterise and validate the model, be clear about whether the data represents incidence or prevalence, as they have different implications for the model's structure and interpretation.

## Difference between Policy and Implementation:

There can be discrepancies between the intended policy for ITN distribution and the actual implementation on the ground. Consider the following:

```{=tex}
\begin{itemize}

\item Coverage: The planned ITN coverage may differ from the actual coverage achieved due to factors such as logistics, access to remote areas, and population acceptance. Use data from surveys or distribution records to accurately represent the true coverage in the model.

\item Timing: The timing of ITN distribution campaigns may vary from the planned schedule. This can affect the impact of ITNs on malaria transmission, particularly if the distribution does not align with peak transmission seasons. Incorporate the actual timing of ITN distribution in the model when possible.

\item Effectiveness: The effectiveness of ITNs may differ from the ideal scenario due to factors such as improper usage, wear and tear, and insecticide resistance. Use data from field studies or published literature to inform the parameters related to ITN effectiveness in the model.

\end{itemize}
```

## National Level - Ignoring Spatial Heterogeneity:

Modelling malaria transmission at a national level can overlook important spatial heterogeneities:

```{=tex}
\begin{itemize}

\item Regional variations: Malaria transmission can vary significantly between different regions within a country due to differences in climate, vector ecology, and socio-economic factors. If possible, consider stratifying the model by region or incorporating spatial heterogeneity to capture these variations.

\item Local hotspots: Even within regions, there can be local hotspots of malaria transmission due to factors such as proximity to breeding sites, population density, and human behavior. If data allows, consider incorporating fine-scale spatial data to identify and model these hotspots.

\item Population movement: The movement of people between different areas can introduce or reintroduce malaria parasites, affecting transmission dynamics. If possible, consider incorporating human movement patterns into the model, particularly if there are significant population flows between high and low transmission areas.

\end{itemize}
```

By considering these key points and being aware of the potential pitfalls, you can build more robust and informative models.

## Examples of data use in literature

The report came out on Jan 31, 2024, so there are not many studies that have used the data yet. However, here are a few that are either under review or have been published recently:

-   [Assessing the Therapeutic Efficacy of Artemether-Lumefantrine for Uncomplicated Malaria in Lagos, Nigeria: A Comprehensive Study on Treatment Response and Resistance Markers](https://doi.org/10.21203/rs.3.rs-3985557/v1)

-   [Design, synthesis and Anti-Plasmodial activity of Mortiamide-Lugdunin conjugates](https://doi.org/10.1016/j.bioorg.2024.107307)
