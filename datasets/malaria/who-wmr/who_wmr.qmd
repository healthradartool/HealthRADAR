---
title: "World Malaria Report"
subtitle: "The report provides a comprehensive and up-to-date assessment of trends in malaria control and elimination across the globe."
image: "images/wmr-covers-2023.jpg"
execute:
  message: false
  warning: false
  
page-layout: full
title-block-banner: "#EDF3F9"
title-block-banner-color: "#212529"
categories:
  - malaria
  - epidemiology
  - interventions
  - country-level
  - annual
---

## About the data

The WHO World Malaria report, released on an annual basis, provides a comprehensive and up-to-date assessment of trends in malaria control and elimination across the globe. The annexes to the report provide useful information on the data sources and methods used to compile the World Malaria Report, a set of regional malaria profiles and tables of historical time series of case data, commodity distribution, funding amounts and policy adoption.

These datasets provide information on long term trends in malaria control and enable comparison between countries. The data provided are on an annual time scale at the national level, and would not be suitable for subnational analysis or to explore seasonal trends in malaria.

## Accessing the data

The reports can be accessed on the [WHO website](https://www.who.int/teams/global-malaria-programme/reports). Each report has a web page which includes useful contextual information as well as additional resources. The “Annexes in Excel format” will download as a zip file which should be extracted. The annexes can be viewed in the original report in PDF format, though for modelling it is usually preferable to have an excel spreadsheet.

The most recent report may not contain all years of estimates. Should earlier years be required, one can access the annexes from earlier reports and merge these.

## What does the data look like?

### Description

The list of annexes may vary annually. The information included typically looks like this. Data are available for each country and annually. Some datasheets contain a few years of data, while others report data for the most recent year. To make a longer time series of data, you can access older world malaria reports and annexes from the WHO. Be careful to check the data definitions and information on methodology to be sure that data sets can be concatenated.

The annexes can be found in the report itself as in the following examples: ![](images/annex4F.png "WHO World Malaria Report 2023 Annex 4F")

![](images/annex4H.png "WHO World Malaria Report 2023 Annex 4H")

The annexes can also be downloaded as Excel documents from the report page.

|         |                                                                                                              |
|----------------------|-------------------------------------------------|
| Annex 1 | Data sources and methods                                                                                     |
| Annex 2 | Number of ITNs distributed through campaigns in malaria endemic countries                                    |
| Annex 3 | WHO Regional profiles                                                                                        |
| Annex 4 | Data tables and methods                                                                                      |
|         | A. Policy adoption                                                                                           |
|         | B. Antimalarial drug policy                                                                                  |
|         | C. Funding for malaria control                                                                               |
|         | D. Commodities distribution and coverage                                                                     |
|         | E. Household survey results                                                                                  |
|         | F. Population denominator for case incidence and mortality rate, and estimated malaria cases and deaths      |
|         | G. Population denominator for case incidence and mortality rate, and reported malaria cases by place of care |
|         | H. Reported malaria cases by method of confirmation                                                          |
|         | I. Reported malaria cases by species                                                                         |
|         | J. Reported malaria deaths                                                                                   |
|         | K. Methods for Tables A-D-G-H-I-J                                                                            |

: Example of the annex layout. This example is from the 2023 world malaria report. Note that the annexes are paired with the report and should be interpreted as such.

::: {.callout-note collapse=true}

## How to use this data?

Here is an example illustrating how to download the data, unzip it and read in a sheet. Sometimes the data needs to be prepared before it is able to be used. For this example, the goal is to get the reported malaria deaths for the elimination 8 (E8) countries, but your specific analysis may require different data.

Let's start by downloading the data for the 2023 World Malaria Report. The following code will download the annexes, unzip them, and locate annex 4J, which contains the reported malaria deaths by country.

```{r}

downloadIfNotExists <- function(url, filename) {
  if (!file.exists(filename)) {
    download.file(url, filename)
  }
  if (!dir.exists(gsub(".zip", "", filename))) {
    zip::unzip(zipfile = filename, exdir = gsub(".zip", "", filename))
  }
  fnames <- list.files(gsub(".zip", "", filename), recursive = T, full.names = T)
  gsub(paste0("^",gsub(".zip", "", filename),"/"), "", fnames)
}

# Download and unzip the annexes:
url <- "https://cdn.who.int/media/docs/default-source/malaria/world-malaria-reports/wmr2023-excel-annexes.zip"
pathbase <- tempdir()
fpaths <- downloadIfNotExists(url, filename=file.path(pathbase,"wmr2023-excel-annexes.zip"))

# list.files(file.path(pathbase,"wmr2023-excel-annexes/WMR2023_Annex"))

# Read in the sheet. Please note that this is specific to the 2023 WMR report and may not work for other years.
filename <- file.path(pathbase,"wmr2023-excel-annexes/WMR2023_Annex/WMR2023_Annex_4J.xlsx")

```

Now that we know where annex is located, we can read it in and start cleaning it. This part may require inspecting the data beforehand to understand how it is structured.

```{r}

library(tidyverse)
library(gt)

wmr2023j <- readxl::read_excel(filename, 
sheet = "Annex_J", # Setting your sheet is good practice even if there is only one sheet.
skip = 2 # Skip the first two rows of the sheet, which contain metadata.
)

# View the raw dataset. The gt package is used for better formatting, but this is optional.
gt(head(wmr2023j))

```

The E8 countries are Botswana, Eswatini, Namibia, South Africa, Angola, Mozambique, Zambia, and Zimbabwe. To filter the data for these countries, you can use the following code:

```{r}

# Define the E8 countries
e8_countries <- c("Botswana", "Eswatini", "Namibia", "South Africa", "Angola", "Mozambique", "Zambia", "Zimbabwe")

# Rename the first column for easier reference
colnames(wmr2023j)[1] <- "WHO_region_Country_area"

# Filter the data for the E8 countries
wmr2023j_e8 <- wmr2023j %>% dplyr::filter(WHO_region_Country_area %in% e8_countries)

# Since we have removed the region and area information, we can rename the column to just "Country"
colnames(wmr2023j_e8)[1] <- "Country"

# View the filtered dataset
gt(wmr2023j_e8)

```


::: callout-warning
Should the above link not work, find it at <https://www.who.int/teams/global-malaria-programme/reports>
:::

<br>

:::


::: {.callout-note collapse=true}

## How to plot this data?

```{r include=FALSE}

filename <- file.path(pathbase,"wmr2023-excel-annexes/WMR2023_Annex/WMR2023_Annex_4Ea.xlsx")

wmr2023Ea_Africa <- readxl::read_excel(filename, 
  sheet = "data", # Setting your sheet is good practice even if there is only one sheet.
  range = "A7:C33", # Specify the range of the data
  col_names = c("Country", "Source", "Percentage") # Specify if the first row contains column names
)

```



```{r}

# Sort the data by percentage
wmr2023Ea_Africa <- wmr2023Ea_Africa %>%
  arrange(Percentage)

# Create the lollipop plot
ggplot(wmr2023Ea_Africa, aes(x = reorder(Country, Percentage), y = Percentage, color = Source)) +
  geom_segment(aes(x = Country, xend = Country, y = 0, yend = Percentage), color = "grey") +
  geom_point(size = 4) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Percentage of Households with at least one ITN",
       subtitle = "Data for selected African countries",
       caption = "Source WMR 2023 Annex 4Ea",
       x = "Country",
       y = "Percentage",
       color = "Source") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 20, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 15),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    legend.title = element_text(size = 15),
    legend.text = element_text(size = 12)
  )


```

TODO: JN/JT add short description of the plot with context

```{r}

library(ggrepel)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)

# Load the map data for Africa
africa <- ne_countries(continent = "Africa", returnclass = "sf")

# Define the elimination 8 countries
e8_countries <- c("Botswana", "Eswatini", "Namibia", "South Africa", "Angola", "Mozambique", "Zambia", "Zimbabwe")

# Rename "eSwatini" in africa to match the data using dplyr
africa <- africa %>%
  mutate(name = ifelse(name == "eSwatini", "Eswatini", name))

# Subset by the elimination 8 countries
e8_africa <- africa %>% 
  filter(name %in% e8_countries)

# Merge the map data with your data
e8_data <- e8_africa %>%
  left_join(wmr2023j_e8, by = c("name" = "Country"))

# Create the choropleth map
ggplot(data = e8_data) +
  geom_sf(aes(fill = `2022`), color = "lightgrey", size = 0.3) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50", name = "Reported Deaths") +
  theme_minimal() +
  labs(title = "Reported malaria deaths in the Elimination 8 countries (2022)",
       caption = "Source: WMR 2023 Annex 4J",
       x = "Latitude",
       y = "Longitude") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    legend.position = "right"
  ) +
  geom_sf_text(aes(label = name, fill = `2022`, color = ifelse(`2022` > mean(`2022`), "black", "white")), size = 3) +
  scale_color_identity()

```

TODO: JN/JT add short description of the plot. Discuss context etc.

```{r}
options(scipen = 9)

# Read in the csv file
data <- read_csv("tutorial_data/filtered_data.csv")

# Divide the cases and deaths by 1000 for better readability
data$Cases_Point <- data$Cases_Point / 1000
data$Cases_Lower <- data$Cases_Lower / 1000
data$Cases_Upper <- data$Cases_Upper / 1000
data$Deaths_Point <- data$Deaths_Point / 1000
data$Deaths_Lower <- data$Deaths_Lower / 1000
data$Deaths_Upper <- data$Deaths_Upper / 1000

```

```{r}
# Create the plot for Deaths with low and high bands
ggplot(data, aes(x = Year, y = Cases_Point, group = Country, color = Country)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = Cases_Lower, ymax = Cases_Upper, fill = Country), alpha = 0.2) +
  labs(
    title = "Estimated Malaria Cases (2000-2022)",
    subtitle = "With confidence bands",
    x = "Year",
    y = "Number of Cases (thousands)",
    color = "Country",
    fill = "Country",
    caption = "Source: WMR 2023 Annex 4F"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 14, face = "bold"),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    plot.margin = margin(t = 20, r = 20, b = 40, l = 20)
  ) +
  guides(color = guide_legend(title.position = "top", title.hjust = 0.5),
         fill = guide_legend(title.position = "top", title.hjust = 0.5))
```

TODO: JN/JT add short description of the plot

```{r}

# Read in the costing data
costing_df <- read_csv("tutorial_data/costing_df.csv")

# Reshape data for plotting
plot_df <- costing_df %>%
  pivot_longer(cols = starts_with("Country_"), names_to = "Donor", values_to = "Amount") %>%
  mutate(Donor = gsub("Country_", "", Donor)) # Remove "Country_" from the Donor names

# Set the order of the donors so that "Govt_NMP" is last
plot_df$Donor <- factor(plot_df$Donor, levels = c(
  "GlobalFund", "WorldBank", "PMI_USAID", "OtherBilaterals", 
  "WHO", "UNICEF","Govt_NMP", "OtherContributions"
))

# Define a manual color palette
manual_colors <- c(
  "GlobalFund" = "#1b9e77", 
  "PMI_USAID" = "#d95f02", 
  "WorldBank" = "#7570b3", 
  "OtherBilaterals" = "#e7298a", 
  "WHO" = "#66a61e", 
  "UNICEF" = "#e6ab02", 
  "OtherContributions" = "#a6761d", 
  "Govt_NMP" = "#666666"
)

# Create the plot
ggplot(plot_df, aes(x = Year, y = Amount / 1000, fill = Donor)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~ Country, scales = "free_y") +
  scale_fill_manual(values = manual_colors) + # Use the manual color palette
  labs(
    title = "Stacked Bar Plot of Country Contributions Over the Years",
    subtitle = "For Selected Countries",
    x = "Year",
    y = "Contributions (in thousands)",
    fill = "Donor",
    caption = "Source: WMR 2023 4C"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(hjust = 0, size = 10, face = "italic"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

TODO: JN/JT add short description of the plot

:::

## Key points to consider

### Pitfalls of Annual Data:

Using annual data for your analysis can lead to several pitfalls:

```{=tex}
\begin{itemize}

\item Seasonal variations: Annual data may not capture the seasonal patterns of malaria transmission, which can be influenced by factors such as rainfall, temperature, and vector abundance. This can lead to an over- or underestimation of the disease burden and the impact of interventions.

\item Temporal aggregation: Aggregating data annually may mask important short-term dynamics, such as outbreaks or the immediate impact of interventions.

\end{itemize}
```

### Reporting - Incidence vs. Prevalence Data:

It is important to distinguish between incidence and prevalence data when performing your analysis:

```{=tex}
\begin{itemize}

\item Incidence data: Incidence refers to the number of new cases of malaria occurring in a population over a specified period. It provides information on the rate at which new infections occur and is more sensitive to changes in transmission dynamics.

\item Prevalence data: Prevalence refers to the proportion of the population that has malaria at a given point in time. It provides a snapshot of the disease burden but does not capture the rate of new infections.

\end{itemize}
```

### Difference between Policy and Implementation:

There can be discrepancies between the intended policy for ITN distribution and the actual implementation on the ground. Consider the following:

```{=tex}
\begin{itemize}

\item Coverage: The planned ITN coverage may differ from the actual coverage achieved due to factors such as logistics, access to remote areas, and population acceptance.

\item Timing: The timing of ITN distribution campaigns may vary from the planned schedule. This can affect the impact of ITNs on malaria transmission, particularly if the distribution does not align with peak transmission seasons. 

\item Effectiveness: The effectiveness of ITNs may differ from the ideal scenario due to factors such as improper usage, wear and tear, and insecticide resistance.

\end{itemize}
```

### National Level - Ignoring Spatial Heterogeneity:

Modelling malaria transmission at a national level can overlook important spatial heterogeneities:

```{=tex}
\begin{itemize}

\item Regional variations: Malaria transmission can vary significantly between different regions within a country due to differences in climate, vector ecology, and socio-economic factors. 

\item Local hotspots: Even within regions, there can be local hotspots of malaria transmission due to factors such as proximity to breeding sites, population density, and human behavior.

\item Population movement: The movement of people between different areas can introduce or reintroduce malaria parasites, affecting transmission dynamics.

\end{itemize}
```

## Examples of data use in literature

The report came out on Jan 31, 2024, so there are not many studies that have used the data yet. However, here are a few that are either under review or have been published recently:

-   [Assessing the Therapeutic Efficacy of Artemether-Lumefantrine for Uncomplicated Malaria in Lagos, Nigeria: A Comprehensive Study on Treatment Response and Resistance Markers](https://doi.org/10.21203/rs.3.rs-3985557/v1)

-   [Design, synthesis and Anti-Plasmodial activity of Mortiamide-Lugdunin conjugates](https://doi.org/10.1016/j.bioorg.2024.107307)
