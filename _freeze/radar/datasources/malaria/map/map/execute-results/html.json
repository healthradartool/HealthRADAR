{
  "hash": "e8d8f3c47e5f317c8a8fa8c63c1ecf39",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Malaria Atlas Project (MAP)\"\ndescription: \"The Malaria Atlas Project (MAP) is a leading global resource that compiles and analyses spatial data on malaria transmission and prevalence.\"\ndate: 09/23/2024 # mm-dd-yyyy\nimage: \"images/map.png\"\n\ncategories:\n  - malaria\n  - epidemiology\n  - spatiotemporal\n  - raster\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n:::: {.page-tabs .panel-tabset}\n## Overview\n\n<h2>About the data</h2>\n\nThe Malaria Atlas Project (MAP) is a leading global resource that\ncompiles and analyses spatial data on malaria transmission and\nprevalence. The MAP site houses millions of data elements and provides\ninnovative analytical approaches to making sense of complex malaria\ndata.\n\nThe analytical approaches available on the site use geospatial analysis,\nspatiotemporal statistical methods, machine learning, and computational\ndisease models.\n\nCollaboratively, MAP produces these outputs with a core team based at\nthe Telethon Kids Institute and Curtin University in Perth, Western\nAustralia; and Ifakara Health Institute in Dar es Salaam in Tanzania.\nMAP also has members across Europe, the United States, Africa and Asia.\n\n<h2>Accessing the data</h2>\n\nMAP data can be accessed directly from <https://data.malariaatlas.org/>\nin various formats, including by:\n\n1.  Generating maps and charts on the site, and selecting parameters of\n    interest. The site also allows various variables to be overlaid\n    spatially.\n\n2.  Downloading CSV and Raster file formats for analysis using other\n    software outside the site. The download process allows users to\n    filter for national and subnational areas of interest.\n\n<h2>What does the data look like?</h2>\n\n**Description**\n\nMAP estimated data on malaria covers morbidity, mortality,\ninterventions, and contributing factors, primarily covering the years\nfrom 2000 to 2022 (as of 2024). Specifically;\n\n-   Incidence and prevalence\n-   Mortality\n-   Treatment\n-   Accessibility factors\n-   Insecticide-treated nets (ITNs)\n-   Indoor residual spraying\n-   Vector occurrence\n-   Human population\n-   Housing quality\n-   Zoonotic malaria\n\nThe data listed above can be found at <https://data.malariaatlas.org/>\n\n![MAP-Data landing page](images/figure1.png){width=\"100%\"\nfig-align=\"center\"}\n\n<h2>Key points to consider</h2>\n\n#### Estimates vs. data\n\nMost information provided by MAP comprises modelled estimates rather\nthan definitive data, which may carry inherent uncertainties.\nConsequently, it is essential to acknowledge the uncertainties\nassociated with the data when drawing conclusions.\n\n#### Pitfalls of annual data\n\nMAP data are aggregated annually, which may lead to several pitfalls\nsuch as;\n\n-   Seasonal variations: Annual data may not capture the seasonal\n    patterns of malaria transmission, which can be influenced by factors\n    such as rainfall, temperature, and vector abundance. This can lead\n    to an over- or underestimation of the disease burden and the impact\n    of interventions.\n\n-   Temporal aggregation: Aggregating data annually may mask important\n    short-term dynamics, such as outbreaks or the immediate impact of\n    interventions.\n\n## Visualisations\n\n<h2>How to use this data?</h2>\n\nThe tabs below have videos that will help you navigate through the MAP\ndata. These guides are also found on MAP's \\|\\>\n[help](https://data.malariaatlas.org/help?tab=trends) page.\n\n::: panel-tabset\n## Trends\n\nTrends Help Guides\n\n\n\n\n{{< video https://www.youtube.com/embed/wCK6XRCG7gQ >}}\n\n\n\n\n\n\n## Maps\n\nMap Help Guide\n\n\n\n\n{{< video https://www.youtube.com/embed/qk68bNVZsXo >}}\n\n\n\n\n\n\n## Commodities\n\nCase Management Help Guide\n\n\n\n\n{{< video https://www.youtube.com/embed/OCJcl1PLPH4 >}}\n\n\n\n\n\n\nInsecticide Treated Nets Help Guide\n\n\n\n\n{{< video https://www.youtube.com/embed/CRC8a1-M3VY >}}\n\n\n\n\n\n:::\n\n<h2>How to plot this data?</h2>\n\nMAP data can be downloaded in both CSV and raster formats. We provide an\nexample of how to extract and plot data for each format.\n\n#### CSV format\n\nMAP's CSV data can be downloaded to have both national and subnational\nlevel data for the metric(s) of interest. We intend to plot ITN data at\na subnational level. The data can be downloaded as explained in the\nTrends videos above. Alternatively,\n\n1.  Click on the \"Interventions\" tab\n\n2.  Select \"Subnational\"\n\n3.  Click the \"Download ITN rate Data\" button to start the download.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# To retrieve data, we used the following link:\n# https://data.malariaatlas.org/trends?year=2018&metricGroup=Interventions&geographicLevel=admin1&metricSubcategory=ITN&metricType=rate&metricName=use\n\n\nlibrary(tidyverse)\nsource(here::here(\"radar/theme_health_radar.R\"))\n\n# Load the selected data\n\ndf <- read.csv(\"Subnational_Unit-data.csv\") |>  \n  filter(National.Unit == \"Malawi\", Year == 2022) \n\n# Plot ITN metrics at a subnational level in Malawi\n\nggplot(data = df) +\n  geom_col(aes(x = Year, y = Value, fill = Metric), position = position_dodge()) +\n  facet_wrap(~ Name) + \n  scale_x_continuous(breaks = seq(min(df$Year), max(df$Year), by = 2)) +  # Custom x-axis breaks\n  scale_fill_manual(values = c(\"Access\" = \"#1b9e77\", \"Use\" = \"#d95f02\", \"Use Rate\" = \"#7570b3\")) + # Custom colors for each Metric\n  labs(\n    y = \"Per 100 people\", \n    title = str_wrap(\"Estimated subnational ITN use, access, and use rate in Malawi in 2022\", width = 45),\n    caption = str_wrap(\"Figure shows the estimated subnational ITN use, access, and use rate (ITN use given access) in Malawi in the year 2022. Source: MAP 2024.\",width = 90)\n  ) +\n  theme_health_radar() +\n  theme(panel.background = element_rect(fill = \"#F0F0F0\", color = NA)) # Add light background to each facet panel\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Raster format data extraction and plotting\n\nUsing raster data is beneficial when analysing data at a smaller\ngeographic scale than the subnational level, which the CSV format does\nnot accommodate. The example outlined below demonstrates the extraction\nof healthcare access data at the district level, but can be utilised at\nany level.\n\nTo extract data from a raster file, you will need two types of data:\n\n1.  A raster file from MAP, and\n\n2.  A shapefile containing the polygons (geographical area) you wish to\n    extract data for.\n\nTo download raster files from the MAP website,\n\n1.  Click on \"Maps\"\n\n2.  Select the drop down arrow titled \"Layer Catalogue\"\n\n3.  Select the data theme of interest, such as \"Accessibility\"\n\n4.  Click the \"Download\" symbol.\n\nIn this example, we select \"Global Walking Only Travel Time To\nHealthcare\" as our data theme of interest.\n\nShapefiles can be obtained from a range of sources. We download Zambia's\ndistrict level polygon from [GRID3](https://data.grid3.org/).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(terra)\nlibrary(patchwork)\n\n# Specific link used to access Shapefile: (https://data.grid3.org/datasets/d27357c640394f11943316e36cebaba3_0/about)\n\n# Load the data and filter by provinces of interest\nshp_zambia <- sf::st_read(\n  file.path(\"Zambia_-_Administrative_District_Boundaries_2022\", \n            \"Zambia_-_Administrative_District_Boundaries_2022.shp\"), \n  quiet = TRUE) |>  \n  filter(PROVINCE %in% c(\"Eastern\", \"Northern\", \"Southern\", \"Western\")) \n\n\n# Load raster file containing walking only travel time to healthcare\nraster_walk <- rast(\"Global_Walking_Only_Travel_Time_To_Healthcare_ZMB.tiff\")\n\n# Extract mean walking time to health facility in each district \ndf_walk <- terra::extract(raster_walk, shp_zambia, mean, na.rm = T, ID = T) |>  \n  as.data.frame() |>  \n  tibble::rownames_to_column() |> \n  mutate(OBJECTID = as.numeric(rowname)) |>  #OBJECTID is the unique ID in the shapefile\n  left_join(shp_zambia, by = c(\"OBJECTID\"))\n\n# Split the dataframe by province to allow for easy plotting\n\nlist_district_df <- split(df_walk, df_walk$PROVINCE)\n\n# Function that creates a ggplot for a given dataframe 'df'\nfun_plot <- function(df) {\n  ggplot(\n    data = df, aes(\n    y = reorder(DISTRICT, Global_Walking_Only_Travel_Time_To_Healthcare_ZMB), \n    x = Global_Walking_Only_Travel_Time_To_Healthcare_ZMB)\n  ) +\n    geom_col(fill = theme_health_radar_colours[5]) +\n    theme_health_radar() +\n    geom_text(\n      aes(label = round(Global_Walking_Only_Travel_Time_To_Healthcare_ZMB)), \n      hjust = -0.2, size = 2.5\n    ) +\n    labs(x = \"\", y = \"\", title = df$PROVINCE) + # Sets axis labels to blank and title to province name\n    xlim(0, 450) +\n    theme_bw() # add borders to plots\n}\n\n\n# Applying 'fun_plot' to each dataframe in 'list_district_df' and combine plots\nReduce(`+`, lapply(list_district_df, fun_plot)) + \n   # To add annotations to the combined plot\n  plot_annotation(\n    title = str_wrap(\"Average walking time in minutes to access healthcare in Zambia's Eastern, Northern, Southern, and Western province, by district\"),\n    caption = str_wrap(\"This illustrative plot shows the average walking time in minutes of various districts in selected provinces. The figure indicates that Northern province has districts with the highest walking time to access healthcare, i.e. up to five hours. Source: MAP\", width = 100),\n    theme = theme_health_radar()\n    )\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n## Modelling Example\n\n<h2>How can this data be used in disease modelling?</h2>\n\nAs earlier alluded, that MAP provides modelled estimates for various\ninterventions including indoor residual spraying (IRS). Below, we show\nhow IRS estimates from MAP can can be used for disease modeling.\n\n### Preparing the data\n\nThe code below demonstrates how IRS data downloaded from MAP can be\nprepared for modeling, using data from Zambia as an illustrative\nexample. In the code, we show that the coverage data are presented on a\nyearly basis, as depicted in the plot. However, further manipulation is\nrequired to meet most mathematical modeling requirements. Specifically,\nin this example, we generate the absolute number of households sprayed\nand, subsequently, the number of individuals protected.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Load packages \nlibrary(deSolve)\nlibrary(tidyverse)\nlibrary(readxl)\n\n# Read in IRS data.\n\nIRSdata <- read.csv(\"National Unit-data.csv\") |>  \n  mutate(sprayed = (Value/100)*3600000, # estimated number of households sprayed\n         time = c(seq(0, 3285, by = 365))) #time steps for each year for 10 years\n            \n\n# Coverage plot\n\nggplot(data = IRSdata, aes(x = Year, y = Value)) +\n  geom_line(color = theme_health_radar_colours[2], linewidth = 0.8) +\n  geom_text(\n    aes(label = round(Value)), \n    hjust = -0.2, size = 2.5\n  ) +\n  labs(\n    x = \"Year\",\n    y = \"IRS Coverage (%)\",\n    title = \"Countrywide IRS coverage for Zambia\",\n    caption = str_wrap(\"This plot illustrates yearly country-wide IRS coverage from 2013 to 2022. The graph reveals fluctuations in coverage over the years, with a notable low in 2018. Source: MAP\", width = 90)\n  ) +\n  scale_x_continuous(breaks = round(seq(min(IRSdata$Year), max(IRSdata$Year), by = 1))) + # Rounding x-axis values\n  theme_health_radar()\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n### Model assumptions\n\nTo create a robust model, it's crucial to articulate the assumptions\nunderlying the dynamics. In our illustrative model in the code below\nrepresented in the SEACR (Susceptible, Exposed, Asymptomatic but infectious, Clinically symptomatic and infectious, Recovered)\nmodel. We assumed the following:\n\n-   Constant population of about 17,000,000, with 5 individuals per\n    household.\n-   Constant seasonality variability - using seasonal forcing function\n-   All areas in the focus country are eligible for IRS\n-   Vector population is at equilibrium\n-   Transmission occurs through the contact between infected mosquitoes\n    and susceptible humans, and vice versa.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Define basic dynamic Human-static Vector model ####\nseirs <- function(t, x, parms)  {\n  with(as.list(c(parms, x)), {\n    M = Sm+Em+Im\n    P = S+E+A+C+R\n    m = M/P\n    \n    # Time dependent IRS coverage\n    IRSc = IRSdata$sprayed*pp_h/P # proportion of the population covered by Current spraying cycle\n    IRSt = IRSdata$time\n    IRSe = phi*pmin(1, IRSc) # effective IRS coverage\n    \n    IRS <- approx(IRSt, IRSe, t, method = \"constant\", rule = 2)$y # annual IRS implementation\n    seasn = seasn_0*(1 + amp*cospi((t - psi)/360)^2) # Seasonality\n    IRSs <- IRS*seasn # Seasonal implementation\n    Infectious <- C + zeta_a*A #infectious reservoir\n    \n    # Force of infection\n    lambda = ((a^2*b*c*m*Infectious/P)/(a*c*Infectious/P+mu_m)*(gamma_m/(gamma_m+mu_m)))*(1-IRSs)\n    \n    dSm=0\n    dEm=0\n    dIm=0\n    dS= mu_h*P - lambda*S + rho*R - mu_h*S\n    dE= lambda*S - (gamma_h + mu_h)*E\n    dA= pa*gamma_h*E - (delta + mu_h)*A\n    dC= (1-pa)*gamma_h*E - (r + mu_h)*C\n    dR= delta*A + r*C - (rho + mu_h)*R\n    \n    dCInc = lambda*S\n    \n    output <- c(dSm, dEm, dIm, dS, dE, dA, dC, dR, dCInc)\n    list(output)\n  })\n}\n# Input definitions ####\n#Initial values\nstart <- c(Sm = 30000000, # susceptible mosquitoes\n           Em = 20000000, # exposed and infected mosquitoes\n           Im = 800000, # infectious mosquitoes\n           S = 10000000, # susceptible humans\n           E = 4000000, # exposed and infected humans\n           A = 1000000, # asymptomatic and infectious humans\n           C = 2000000, # clinical and symptomatic humans\n           R = 0, # recovered and semi-immune humans\n           CInc = 0) # cumulative incidence\n\n\n# Parameters\nparms <- c(a = 0.3, #human feeding rate per mosquito\n           b = 0.5, # transmission efficiency M->H\n           c = 0.5, # transmission efficiency H->M\n           gamma_m = 1/10, #rate of onset of infectiousness in mosquitoes\n           mu_m = 1/15, #natural birth/death rate in mosquitoes\n           mu_h = 1/(70*365), #natural birth/death rate in humans\n           gamma_h = 1/20, #rate of onset of infectiousness in humans\n           r=1/50, # recovery rate \n           rho = 1/(1*365), # rate of loss of immunity after recovery\n           delta = 1/150, # natural recovery rate\n           zeta_a = 0.4, # relative infectiousness of asymptomatic infections\n           pa = 0.4, # probability of asymptomatic infection\n           pp_h = 5, # number people per household\n           no_hh = 3600000, # total number of households\n           phi = 0.8, # IRS effectiveness\n           seasn_0 = 0.7, #\n           amp = 0.7, # Amplitude\n           psi = pi # Phase\n)\n\n# Vector of timesteps\nnoy = 10 # number of years \ntimes <- seq(0, 364*noy, 1) # time in days\n\n# Run models ####\n\nhm<-ode(times=times, y=start, func=seirs,parms=parms)\n```\n:::\n\n\n\n\n### Implications for transmission and incidence\n\nIn this example, we plot daily incidence from 2013 to 2022. As Indoor Residual Spraying (IRS) is intended to repel and kill mosquitoes, we anticipate a reduced human biting rate and therefore lower transmission rates. Plotting incidence for this model may highlight the estimated impact of\nIRS on cases over time. However, it is important to note that the\noutputs of this example model have not been calibrated to real data and\nare merely a demonstration, not representative of the actual context.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nhmplot <- as_tibble(as.data.frame(hm)) |>  \n  mutate(\n    P=S+E+A+C+R,\n    Inc = c(0, diff(CInc))\n  ) |>  \n  pivot_longer(names_to = \"variable\", cols = !1) |>  \n  mutate(model = \"human\") |>  \n  filter(variable == \"Inc\")\n\n\nggplot(data = hmplot, aes(y = value, x = time / 365 + 2013)) +  # Convert time to years starting from 2013\n    geom_line(color = theme_health_radar_colours[9], linewidth = 0.8) +\n    labs(\n      x = \"Year\", \n      y = \"Incidence\", \n      title = \"Daily country-wide incidence\",\n      caption = str_wrap(\"This example plot illustrates the daily country-wide incidence of malaria from 2014 to 2022. The graph reveals fluctuations in incidence over the years, with notable peaks in 2018. This peak coincides with the period when IRS coverage was at its lowest, highlighting the potential impact of reduced intervention efforts on malaria transmission. Source: Model output.\", width = 90)\n    ) +\n    ylim(25000, 50000) + \n    theme_health_radar() +\n    scale_x_continuous(breaks = seq(2013, 2024, by = 2)) +  # Set x-axis breaks to multiples of 2 years\n    xlim(2014, 2022) \n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n::::\n",
    "supporting": [
      "map_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}