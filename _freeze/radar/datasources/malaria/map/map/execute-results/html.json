{
  "hash": "fe90b77ef9021bebc34ecca239f70e7b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Malaria Atlas Project (MAP)\"\ndescription: \"The Malaria Atlas Project (MAP) is a leading global resource that compiles and analyses spatial data on malaria transmission and prevalence.\"\ndate: 09/23/2024 # mm-dd-yyyy\nimage: \"images/map.png\"\n\ncategories:\n  - malaria\n  - epidemiology\n  - spatiotemporal\n  - raster\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n\n:::: {.page-tabs .panel-tabset}\n## Overview\n\n<h2>About the data</h2>\n\nThe Malaria Atlas Project (MAP) is a leading global resource that\ncompiles and analyses spatial data on malaria transmission and\nprevalence. The MAP site houses millions of data elements and provides\ninnovative analytical approaches to making sense of complex malaria\ndata.\n\nThe analytical approaches available on the site use geospatial analysis,\nspatiotemporal statistical methods, machine learning, and computational\ndisease models.\n\nCollaboratively, MAP produces these outputs with a core team based at\nthe Telethon Kids Institute and Curtin University in Perth, Western\nAustralia; and Ifakara Health Institute in Dar es Salaam in Tanzania.\nMAP also has members across Europe, the United States, Africa and Asia.\n\n<h2>Accessing the data</h2>\n\nMAP data can be accessed directly from <https://data.malariaatlas.org/>\nin various formats, including by:\n\n1.  Generating maps and charts on the site, and selecting parameters of\n    interest. The site also allows various variables to be overlaid\n    spatially.\n\n2.  Downloading CSV and Raster file formats for analysis using other\n    software outside the site. The download process allows users to\n    filter for national and subnational areas of interest.\n\n<h2>What does the data look like?</h2>\n\n**Description**\n\nMAP estimated data on malaria covers morbidity, mortality,\ninterventions, and contributing factors, primarily covering the years\nfrom 2000 to 2022 (as of 2024). Specifically;\n\n-   Incidence and prevalence\n-   Mortality\n-   Treatment\n-   Accessibility factors\n-   Insecticide-treated nets (ITNs)\n-   Indoor residual spraying\n-   Vector occurrence\n-   Human population\n-   Housing quality\n-   Zoonotic malaria\n\nThe data listed above can be found at <https://data.malariaatlas.org/>\n\n![MAP-Data landing page](images/figure1.png){width=\"100%\"\nfig-align=\"center\"}\n\n<h2>Key points to consider</h2>\n\n#### Estimates vs. data\n\nMost information provided by MAP comprises modelled estimates rather\nthan definitive data, which may carry inherent uncertainties.\nConsequently, it is essential to acknowledge the uncertainties\nassociated with the data when drawing conclusions.\n\n#### Pitfalls of annual data\n\nMAP data are aggregated annually, which may lead to several pitfalls\nsuch as;\n\n-   Seasonal variations: Annual data may not capture the seasonal\n    patterns of malaria transmission, which can be influenced by factors\n    such as rainfall, temperature, and vector abundance. This can lead\n    to an over- or underestimation of the disease burden and the impact\n    of interventions.\n\n-   Temporal aggregation: Aggregating data annually may mask important\n    short-term dynamics, such as outbreaks or the immediate impact of\n    interventions.\n\n## Visualisations\n\n<h2>How to use this data?</h2>\n\nThe tabs below have videos that will help you navigate through the MAP\ndata. These guides are also found on MAP's \\|\\>\n[help](https://data.malariaatlas.org/help?tab=trends) page.\n\n::: panel-tabset\n## Trends\n\nTrends Help Guides\n\n\n\n\n\n{{< video https://www.youtube.com/embed/wCK6XRCG7gQ >}}\n\n\n\n\n\n\n\n\n## Maps\n\nMap Help Guide\n\n\n\n\n\n{{< video https://www.youtube.com/embed/qk68bNVZsXo >}}\n\n\n\n\n\n\n\n\n## Commodities\n\nCase Management Help Guide\n\n\n\n\n\n{{< video https://www.youtube.com/embed/OCJcl1PLPH4 >}}\n\n\n\n\n\n\n\n\nInsecticide Treated Nets Help Guide\n\n\n\n\n\n{{< video https://www.youtube.com/embed/CRC8a1-M3VY >}}\n\n\n\n\n\n\n\n:::\n\n<h2>How to plot this data?</h2>\n\nMAP data can be downloaded in both CSV and raster formats. We provide an\nexample of how to extract and plot data for each format.\n\n#### CSV format\n\nMAP's CSV data can be downloaded to have both national and subnational\nlevel data for the metric(s) of interest. We intend to plot ITN data at\na subnational level. The data can be downloaded as explained in the\nTrends videos above. Alternatively,\n\n1.  Click on the \"Interventions\" tab\n\n2.  Select \"Subnational\"\n\n3.  Click the \"Download ITN rate Data\" button to start the download.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# To retrieve data, we used the following link:\n# https://data.malariaatlas.org/trends?year=2018&metricGroup=Interventions&geographicLevel=admin1&metricSubcategory=ITN&metricType=rate&metricName=use\n\n\nlibrary(tidyverse)\nsource(here::here(\"radar/theme_health_radar.R\"))\n\n# Load the selected data\n\ndf <- read.csv(\"Subnational_Unit-data.csv\") |>  \n  filter(National.Unit == \"Malawi\", Year == 2022) \n\n# Plot ITN metrics at a subnational level in Malawi\n\nggplot(data = df) +\n  geom_col(aes(x = Year, y = Value, fill = Metric), position = position_dodge()) +\n  facet_wrap(~ Name) + \n  scale_x_continuous(breaks = seq(min(df$Year), max(df$Year), by = 2)) +  # Custom x-axis breaks\n  scale_fill_manual(values = c(\"Access\" = \"#1b9e77\", \"Use\" = \"#d95f02\", \"Use Rate\" = \"#7570b3\")) + # Custom colors for each Metric\n  labs(\n    y = \"Per 100 people\", \n    title = str_wrap(\"Estimated subnational ITN use, access, and use rate in Malawi in 2022\", width = 45),\n    caption = str_wrap(\"Figure shows the estimated subnational ITN use, access, and use rate (ITN use given access) in Malawi in the year 2022. Source: MAP 2024.\",width = 90)\n  ) +\n  theme_health_radar() +\n  theme(panel.background = element_rect(fill = \"#F0F0F0\", color = NA)) # Add light background to each facet panel\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Raster format data extraction and plotting\n\nUsing raster data is beneficial when analysing data at a smaller\ngeographic scale than the subnational level, which the CSV format does\nnot accommodate. The example outlined below demonstrates the extraction\nof healthcare access data at the district level, but can be utilised at\nany level.\n\nTo extract data from a raster file, you will need two types of data:\n\n1.  A raster file from MAP, and\n\n2.  A shapefile containing the polygons (geographical area) you wish to\n    extract data for.\n\nTo download raster files from the MAP website,\n\n1.  Click on \"Maps\"\n\n2.  Select the drop down arrow titled \"Layer Catalogue\"\n\n3.  Select the data theme of interest, such as \"Accessibility\"\n\n4.  Click the \"Download\" symbol.\n\nIn this example, we select \"Global Walking Only Travel Time To\nHealthcare\" as our data theme of interest.\n\nShapefiles can be obtained from a range of sources. We download Zambia's\ndistrict level polygon from [GRID3](https://data.grid3.org/).\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(terra)\nlibrary(patchwork)\n\n# Specific link used to access Shapefile: (https://data.grid3.org/datasets/d27357c640394f11943316e36cebaba3_0/about)\n\n# Load the data and filter by provinces of interest\nshp_zambia <- sf::st_read(\n  file.path(\"Zambia_-_Administrative_District_Boundaries_2022\", \n            \"Zambia_-_Administrative_District_Boundaries_2022.shp\"), \n  quiet = TRUE) |>  \n  filter(PROVINCE %in% c(\"Eastern\", \"Northern\", \"Southern\", \"Western\")) \n\n\n# Load raster file containing walking only travel time to healthcare\nraster_walk <- rast(\"Global_Walking_Only_Travel_Time_To_Healthcare_ZMB.tiff\")\n\n# Extract mean walking time to health facility in each district \ndf_walk <- terra::extract(raster_walk, shp_zambia, mean, na.rm = T, ID = T) |>  \n  as.data.frame() |>  \n  tibble::rownames_to_column() |> \n  mutate(OBJECTID = as.numeric(rowname)) |>  #OBJECTID is the unique ID in the shapefile\n  left_join(shp_zambia, by = c(\"OBJECTID\"))\n\n# Split the dataframe by province to allow for easy plotting\n\nlist_district_df <- split(df_walk, df_walk$PROVINCE)\n\n# Function that creates a ggplot for a given dataframe 'df'\nfun_plot <- function(df) {\n  ggplot(\n    data = df, aes(\n    y = reorder(DISTRICT, Global_Walking_Only_Travel_Time_To_Healthcare_ZMB), \n    x = Global_Walking_Only_Travel_Time_To_Healthcare_ZMB)\n  ) +\n    geom_col(fill = theme_health_radar_colours[5]) +\n    theme_health_radar() +\n    geom_text(\n      aes(label = round(Global_Walking_Only_Travel_Time_To_Healthcare_ZMB)), \n      hjust = -0.2, size = 2.5\n    ) +\n    labs(x = \"\", y = \"\", title = df$PROVINCE) + # Sets axis labels to blank and title to province name\n    xlim(0, 450) +\n    theme_bw() # add borders to plots\n}\n\n\n# Applying 'fun_plot' to each dataframe in 'list_district_df' and combine plots\nReduce(`+`, lapply(list_district_df, fun_plot)) + \n   # To add annotations to the combined plot\n  plot_annotation(\n    title = str_wrap(\"Average walking time in minutes to access healthcare in Zambia's Eastern, Northern, Southern, and Western province, by district\"),\n    caption = str_wrap(\"This illustrative plot shows the average walking time in minutes of various districts in selected provinces. The figure indicates that Northern province has districts with the highest walking time to access healthcare, i.e. up to five hours. Source: MAP\", width = 100),\n    theme = theme_health_radar()\n    )\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Modelling Example\n\n<h2>How can this data be used in disease modelling?</h2>\n\nThe Malaria Atlas Project provides modelled estimates for various\ninterventions, including indoor residual spraying (IRS). Below, we show\nhow IRS coverage estimates from MAP can be used for disease modeling.\n\n### Preparing the data\n\nThe code below demonstrates how IRS coverage data can be\nprepared for modeling, using data from Zambia as an illustrative\nexample. In the code, we show that the coverage data are presented on a\nannual basis, as depicted in the plot. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Read in IRS data.\n\nIRSdata <- read.csv(\"National Unit-data.csv\") |>  \n  mutate(sprayed = (Value/100)*3600000, # estimated number of households sprayed in Zambia\n         time = c(seq(0, 365*9, by = 365))) # time steps for each year for 10 years\n            \n\n# Coverage plot\n\nggplot(data = IRSdata) +\n  geom_col(aes(x = Year, y = Value, fill = theme_health_radar_colours[9])) +\n  expand_limits(y = 0) + # ensure y-axis starts at 0\n  labs(\n    x = \"Year\",\n    y = \"IRS Coverage (%)\",\n    title = \"Countrywide IRS coverage for Zambia\",\n    caption = str_wrap(\"This plot illustrates yearly country-wide IRS coverage from 2013 to 2022. The graph reveals fluctuations in coverage over the years, with a notable low in 2013 and 2018. Source: MAP\")\n  ) +\n  scale_x_continuous(breaks = round(seq(min(IRSdata$Year), max(IRSdata$Year), by = 1))) + # Rounding x-axis values\n  theme_health_radar() +\n  theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\nTo incorporate this into a mathematical model, we obtain the absolute number of households sprayed from MAP and calculate the actual number of individuals protected. Using a constant human population of about 17,000,000, we assume a number with 5 individuals per household and a total of 3400000 households.\n\n### Model assumptions\n\nIt is crucial to articulate the assumptions underlying the dynamics. In addition to the above, we assume the vector population is at equilibrium, the force of infection is seasonal and all areas are eligible for IRS. \n    \nThe parameters used to inform the model are described below. These should be replaced with country-specific data on seasonality, IRS implementation and other health system dynamics.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| echo: true\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| warning: false\n\nlibrary(deSolve)\n\n# Time points for the simulation\nY = 10 # Years of simulation\ntimes <- seq(0, 364*Y, 1) # time in days\n\n# Make a time dependent function of annual IRS coverage\nirs_cov <- approxfun(IRSdata$time, IRSdata$sprayed, t, method = \"constant\", rule = 2)\n\n# Define basic dynamic Human-static Vector model ####\nseirs <- function(times, start, parameters, irs_cov)  {\n  with(as.list(c(parameters, start)), {\n    P = S + E + A + C + R + G\n    M = Sm + Em + Im\n    m = M / P\n    \n    #browser()\n    # Time dependent IRS coverage\n    IRSc = (irs_cov(times))*pp_h/365/P # daily proportion of the population covered by current spraying cycle \n    IRSe = min(1, IRS)*irs_eff # effective IRS coverage, proportion of population covered by IRS should never be more than 1\n    \n    # Seasonality\n    seas.t <- amp * (1 + cos(2 * pi * (times / 365 - phi)))\n    \n    # Force of infection\n    Infectious <- C + zeta_a*A #infectious reservoir\n    lambda = ((a^2*b*c*m*Infectious/P)/(a*c*Infectious/P+mu_m)*(gamma_m/(gamma_m+mu_m)))*(1-IRSe)*seas.t\n    \n    # Differential equations/rate of change\n    dSm = 0\n    dEm = 0\n    dIm = 0\n    \n    dS = mu_h*P - lambda*S + rho*R - mu_h*S\n    dE = lambda*S - (gamma_h + mu_h)*E\n    dA = pa*gamma_h*E + pa*gamma_h*G - (delta + mu_h)*A\n    dC = (1-pa)*gamma_h*E + (1-pa)*gamma_h*G - (r + mu_h)*C\n    dR = delta*A + r*C - (lambda + rho + mu_h)*R\n    dG = lambda*R - (gamma_h + mu_h)*G\n     \n    dCInc = lambda*(S+R)\n    dIRS = IRSc - decay*IRS\n    \n    output <- c(dSm, dEm, dIm, dS, dE, dA, dC, dR, dG, dCInc, dIRS)\n    list(output)\n  })\n}\n# Input definitions ####\n#Initial values\nstart <- c(Sm = 30000000, # susceptible mosquitoes\n           Em = 20000000, # exposed and infected mosquitoes\n           Im = 800000, # infectious mosquitoes\n           S = 9000000, # susceptible humans\n           E = 1500000, # exposed and infected humans\n           A = 1000000, # asymptomatic and infectious humans\n           C = 2000000, # clinical and symptomatic humans\n           R = 1500000, # recovered and semi-immune humans\n           G = 2000000, # secondary-exposed and infected humans\n           CInc = 0, # cumulative incidence\n           IRS = 0.5 #proportion of the population currently protected by IRS\n           ) \n\n\n# Parameters\nparameters <- c(a = 0.28, # human feeding rate per mosquito\n           b = 0.3, # transmission efficiency M->H\n           c = 0.3, # transmission efficiency H->M\n           gamma_m = 1/10, # rate of onset of infectiousness in mosquitoes\n           mu_m = 1/12, # natural birth/death rate in mosquitoes\n           mu_h = 1/(60*365), # natural birth/death rate in humans\n           gamma_h = 1/10, # rate of onset of infectiousness in humans\n           r = 1/7, # rate of loss of infectiousness after treatment\n           rho = 1/365, # rate of loss of immunity after recovery\n           delta = 1/150, # natural recovery rate\n           zeta_a = 0.4, # relative infectiousness of asymptomatic infections\n           pa = 0.1, # probability of asymptomatic infection\n           pp_h = 5, # number people per household in Zambia\n           irs_eff = 0.8, # IRS effectiveness at reducing transmission\n           decay = 1/(4*30), # rate at which IRS wanes in days\n           amp = 0.6, # Amplitude\n           phi = 200 # phase angle; start of season\n)\n\n# Run the model\nout <- ode(y = start, \n           times = times, \n           func = seirs, \n           parms = parameters,\n           irs_cov = irs_cov)\n```\n:::\n\n\n\n\n\n\nA more complex model may have further incorporated intervention uptake/refusals, as are known to occur with IRS, as well as the biting and resting behaviours of the dominant vector in the country. \n\n![Source: WHO (2014). From malaria control to malaria elimination: a manual for elimination scenario planning.](images/IRS_cascade.PNG)\n\n### Implications for transmission and incidence\n\nIn this example, we plot daily incidence from 2013 to 2022. As Indoor Residual Spraying (IRS) is intended to repel and kill mosquitoes, we anticipate a reduced human biting rate and therefore lower transmission rates. Plotting incidence for this model may highlight the estimated impact of IRS on cases over time. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| echo: true\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| warning: false\n\nmo <- as_tibble(as.data.frame(out)) |>  \n  mutate(\n    P = S + E + A + C + R + G,\n    Inc = c(0, diff(CInc))) |>  \n  pivot_longer(names_to = \"variable\", cols = !1) |>  \n  mutate(date = ymd(\"2013-07-01\") + time)\n\nmo |>\n    filter(variable == \"Inc\", date > ymd(\"2014-01-01\")) |>\n    ggplot(aes(x = date, y = value)) + \n    geom_line(color = theme_health_radar_colours[19]) +\n    labs(\n      x = \"Year\", \n      y = \"Incidence\", \n      title = \"Daily country-wide incidence\",\n      caption = str_wrap(\"This example plot illustrates the daily country-wide incidence of malaria from 2014 to 2022. The graph reveals fluctuations in incidence over the years, with a slight increase in 2019 coinciding with low IRS coverage in 2018. This highlights the potential impact of reduced intervention efforts on malaria transmission. Source: Model output.\")) +\n    theme_health_radar()\n```\n\n::: {.cell-output-display}\n![](map_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n::::\n",
    "supporting": [
      "map_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}